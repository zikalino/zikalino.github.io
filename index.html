
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Zim's Notes</title>
  <meta name="author" content="Your Name">

  
  <meta name="description" content="I have tested new Visual Studio Code Remote Development feature with Azure CLI. Now you can start developing Azure CLI in a few simple steps: Install &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://zikalino.github.io">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Zim's Notes" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=Fjalla+One" rel="stylesheet" type="text/css">
<!--- MathJax Configuration -->
<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  

</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Zim's Notes</a></h1>
  
    <h2>Just work related notes.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscribe" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS" target="_blank"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="25" viewbox="0 0 100 100"><path class="social" d="M 13.310204,73.332654 C 5.967347,73.332654 0,79.322448 0,86.621428 c 0,7.338776 5.967347,13.262246 13.310204,13.262246 7.370408,0 13.328572,-5.92245 13.328572,-13.262246 0,-7.29898 -5.958164,-13.288774 -13.328572,-13.288774 z M 0.01530612,33.978572 V 53.143878 C 12.493878,53.143878 24.229592,58.02347 33.068368,66.865306 41.894898,75.685714 46.767346,87.47449 46.767346,100 h 19.25 C 66.017346,63.592858 36.4,33.979592 0.01530612,33.978572 l 0,0 z M 0.03877552,0 V 19.17449 C 44.54796,19.17551 80.77551,55.437756 80.77551,100 H 100 C 100,44.87653 55.15102,0 0.03877552,0 z"></path></svg></a></li>
  
</ul>
  
  
  
  
  
  
  
  
  
  
    
      <form action="https://www.google.com/search" method="get">
        <fieldset role="search">
          <input type="hidden" name="sitesearch" value="zikalino.github.io" />
    
          <input class="search" type="text" name="q" results="0" placeholder="Search"/>
        </fieldset>
      </form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2019/06/10/setting-azure-cli-development-environment-using-visual-studio-code-remote-development-with-containers/">Setting Azure CLI Development Environment Using Visual Studio Code Remote Development With Containers</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2019-06-10T19:22:11+08:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>10</span><span class='date-suffix'>th</span>, <span class='date-year'>2019</span></span> <span class='time'>7:22 pm</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>I have tested new Visual Studio Code Remote Development feature with Azure CLI. Now you can start developing Azure CLI in a few simple steps:</p>

<ul>
<li>Install Visual Studio Code Insiders Edition</li>
<li>Clone Azure CLI Repository</li>
<li>Launch Visual Studio Code and wait for a few minutes</li>
<li>Set a breakpoint and press F5</li>
</ul>


<p>To replicate this you need do download Visual Studio Code from here:</p>

<p><a href="https://code.visualstudio.com/insiders/">https://code.visualstudio.com/insiders/</a></p>

<p>Clone my fork of Azure CLI repository and switch to <strong>adding-devcontainer-setup</strong> branch.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git clone https://github.com/zikalino/azure-cli.git
</span><span class='line'><span class="nb">cd </span>azure-cli
</span><span class='line'>git checkout adding-devcontainer-setup
</span></code></pre></td></tr></table></div></figure>


<p>Then run Visual Code from cloned repository:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>code-insiders .
</span></code></pre></td></tr></table></div></figure>


<p>Visual Studio Code should detect that <strong>.devcontainer</strong> folder is present, and will ask whether you want to use container.</p>

<p><img src="/images/devcontainer-reopen.png" alt="Reopen in Container" /></p>

<p>When you choose <strong>Reopen in Container</strong>, VSC will build the image from docker file, that may take a few minutes, but it will be done only once (for current folder).</p>

<p><img src="/images/devcontainer-build.png" alt="Build Container" /></p>

<p>When container is ready, just set a breakpoint, for instance in <strong>azure-cli/src/azure-cli/<strong>main</strong>.py</strong> and press <strong>F5</strong>.</p>

<p><img src="/images/devcontainer-run.png" alt="Run Container" /></p>

<h2>More Details on the Container</h2>

<p>My Dockerfile is pretty simple.
As a base I used Ubuntu 16.04, and:</p>

<ul>
<li>Installed Python 3.6</li>
<li>Cloned Azure CLI repo (just to install dependencies)</li>
<li>Created virtual environment located at <strong>/env</strong> (outside Azure CLI repo)</li>
<li>Installed <strong>azdev</strong> using <strong>pip</strong></li>
<li>Installed Azure CLI dependencies using <strong>azdev setup</strong></li>
<li>Made sure that <strong>/env</strong> is activated every time <strong>bash</strong> is started by Visual Studio Code.</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># start from Ubuntu 16.04</span>
</span><span class='line'>FROM ubuntu:xenial
</span><span class='line'>
</span><span class='line'><span class="c"># install python 3.6, pip, venv and git</span>
</span><span class='line'>RUN apt-get update
</span><span class='line'>RUN apt-get -y install software-properties-common
</span><span class='line'>RUN add-apt-repository ppa:deadsnakes/ppa
</span><span class='line'>RUN apt-get update
</span><span class='line'>RUN apt-get -y install python3.6 python3-pip python3-venv git
</span><span class='line'>
</span><span class='line'><span class="c"># clone azure cli into /workspaces/azure-cli</span>
</span><span class='line'>RUN mkdir /workspaces<span class="p">;</span> <span class="nb">cd</span> /workspaces<span class="p">;</span> git clone https://github.com/Azure/azure-cli.git
</span><span class='line'>
</span><span class='line'><span class="c"># create environment in /env and set up </span>
</span><span class='line'>RUN python3 -m venv env
</span><span class='line'>RUN /bin/bash -c <span class="s2">&quot;source /env/bin/activate; pip3 install azdev; azdev setup --cli /workspaces/azure-cli&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c"># remove azure-cli as it will be used </span>
</span><span class='line'>RUN rm -rf ./workspaces/azure-cli
</span><span class='line'>
</span><span class='line'><span class="c"># add environment activation to .bashrc</span>
</span><span class='line'>RUN <span class="nb">echo</span> <span class="s2">&quot;source /env/bin/activate&quot;</span> &gt;&gt; ~/.bashrc
</span></code></pre></td></tr></table></div></figure>


<h2>And Configuration File</h2>

<p>Configuration file <strong>devcontainer.json</strong> is pretty simple. It specifies <strong>Dockerfile</strong> and a path to Python interpreter inside <strong>/env</strong>.</p>

<p>Please note that instead of specifying <strong>dockerFile</strong> it&rsquo;s possible to specify existing <strong>image</strong>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">{</span>
</span><span class='line'>  <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;Azure CLI Dev&quot;</span>,
</span><span class='line'>  <span class="s2">&quot;dockerFile&quot;</span>: <span class="s2">&quot;Dockerfile&quot;</span>,
</span><span class='line'>  <span class="s2">&quot;context&quot;</span>: <span class="s2">&quot;.&quot;</span>,
</span><span class='line'>  <span class="s2">&quot;extensions&quot;</span>: <span class="o">[</span>
</span><span class='line'>      <span class="s2">&quot;ms-python.python&quot;</span>
</span><span class='line'>  <span class="o">]</span>,
</span><span class='line'>  <span class="s2">&quot;settings&quot;</span>: <span class="o">{</span>
</span><span class='line'>      <span class="s2">&quot;python.pythonPath&quot;</span>: <span class="s2">&quot;/env/bin/python3&quot;</span>
</span><span class='line'>  <span class="o">}</span>,
</span><span class='line'>  <span class="s2">&quot;postCreateCommand&quot;</span>: <span class="s2">&quot;bash&quot;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Other Considerations</h2>

<p>(1) It&rsquo;s possible to specify existing image instead of dockerfile. If we have existing development image that would make setup even faster.</p>

<p>(2) Perhaps it would be a good idea to clone all <strong>azure-cli</strong>, <strong>azure-cli-dev-tools</strong>, <strong>azure-cli-extensions</strong> under workspaces. Then it should be possible to map all three of them when starting the container.</p>

<p>(3) Perhaps leaving <strong>azure-cli</strong> (I currently delete it) would be a good idea, this way the container could be used as a standalone dev environment with source code cloned inside.</p>

<p>(4) Instead of cloning <strong>azure-cli</strong> it&rsquo;s possible to map external repository. I am not doing it right now, as there&rsquo;s <strong>.dockerignore</strong> file that would need to be modified in order to make this solution to work, and that could affect</p>

<h2>Documents</h2>

<p>Development environment setup instructions:</p>

<p><a href="https://github.com/Azure/azure-cli-dev-tools">https://github.com/Azure/azure-cli-dev-tools</a></p>

<p>About VSC Remote Development</p>

<p><a href="https://code.visualstudio.com/docs/remote/remote-overview">https://code.visualstudio.com/docs/remote/remote-overview</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2019/05/27/idea-of-using-azure-cli-extension-to-test-validate-fix-and-create-azure-swagger-examples/">Idea of Using Azure CLI Extension to Test, Validate, Fix and Create Azure Swagger Examples</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2019-05-27T11:01:54+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2019</span></span> <span class='time'>11:01 am</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><h2>Overview</h2>

<p>This idea occured to me for several reasons:</p>

<ul>
<li>there&rsquo;s no single tool used to create, test and validate Azure Swagger examples</li>
<li>process of validating and updating Azure REST API examples is quite awkward and time consuming. Updating even single input value reauires a lot of steps, for instance responses should be updated as well</li>
<li>there are no single naming conventions</li>
<li>Azure CLI is the most commonly used tool to manage Azure resources</li>
<li>it would be very easy to create an extension based on <strong>az resource</strong> which already allows raw REST API calls meaning it provides entire framework</li>
</ul>


<h2>Advantages</h2>

<ul>
<li>easy, fast and consistent process of creating new and updating existing examples</li>
<li>validation and dependency checking</li>
<li>enforcing consistent naming conventions, that would lead to more consistent documentation and compatibility between examples (for instance all the examples would use single resource group <strong>myResourceGroup</strong>)</li>
<li>simple way to check examples without using any additional tool</li>
</ul>


<h2>Running / Validating Existing Examples</h2>

<h3>Overview</h3>

<p>The tool should allow to:</p>

<ul>
<li>run existing examples directly from Azure REST API specs (local or GitHub repo)</li>
<li>run examples in their raw form</li>
<li>automatically fix problems / adjust naming conventions to match common naming convention</li>
<li>allow applying custom parameter fixes</li>
<li>generate final adjusted / updated example source code</li>
<li>optionally copy example to original source tree or create a pull request in original GitHub repo (fork of Azure REST API specification)</li>
</ul>


<h3>Command</h3>

<p>To run existing example:</p>

<p><strong>az swagger run &ndash;example {location} [&ndash;raw] [&ndash;override {field}={value}] [&ndash;dependencies] [&ndash;update]</strong></p>

<p>where:</p>

<p><strong>&ndash;example</strong></p>

<p>{location} - either URL of example in GitHub or local path to example in cloned GitHub repo</p>

<p><strong>&ndash;raw</strong></p>

<p>If specified all field values from the example files will be used as is.</p>

<p>By default extension would override existing values using default resource naming conventions.</p>

<p><strong>&ndash;override</strong></p>

<p>{field} - field name or path to a field in</p>

<p><strong>&ndash;dependencies</strong></p>

<p>The tool will attempt to create all the dependencies if they don&rsquo;t exist, e.g. resource group or parent resource (using appropriate examples from swagger).</p>

<p>If this option is note specified, the tool will display appropriate warnings.</p>

<p><strong>&ndash;update</strong></p>

<p>If this option is specified extension will attempt to update existing sample in the local filesystem.
In the future it could create a branch and pull requests directly to the GitHub Repo.</p>

<p>The attempt will be made if:</p>

<ul>
<li>example was run successfully</li>
<li>there are differences between existing example input parameters and overrided input parameters</li>
<li>there is difference in return value specified and value actually returned</li>
</ul>


<p>Sample input could look like that:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>az swagger run --example https://github.com/Azure/azure-rest-api-specs/blob/master/specification/botservice/resource-manager/Microsoft.BotService/preview/2018-07-12/examples/CreateBot.json</span></code></pre></td></tr></table></div></figure>


<p>Sample output could look like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>-------- WARNINGS
</span><span class='line'>- resourceGroupName "OneResourceGroup" was replaced by "myResourceGroup"
</span><span class='line'>- resourceName "sampleBot" was replaced by "myBot"
</span><span class='line'>-------- ORIGINAL EXAMPLE
</span><span class='line'>{
</span><span class='line'>  "parameters": {
</span><span class='line'>    "subscriptionId": "subscription-id",
</span><span class='line'>    "resourceGroupName": "OneResourceGroupName",
</span><span class='line'>    "api-version": "2017-01-01",
</span><span class='line'>    "resourceName": "samplebotname",
</span><span class='line'>    "parameters": {
</span><span class='line'>      "location": "West US",
</span><span class='line'>      "sku": {
</span><span class='line'>        "name": "S1"
</span><span class='line'>      },
</span><span class='line'>      "etag": "etag1",
</span><span class='line'>      "tags": {
</span><span class='line'>        "tag1": "value1",
</span><span class='line'>        "tag2": "value2"
</span><span class='line'>      },
</span><span class='line'>      "name": "samplename",
</span><span class='line'>      "type": "sampletype",
</span><span class='line'>      "id": "someid",
</span><span class='line'>      "kind": "sdk",
</span><span class='line'>      "properties": {
</span><span class='line'>        "description": "The description of the bot",
</span><span class='line'>        "developerAppInsightKey": "appinsightskey",
</span><span class='line'>        "developerAppInsightsApiKey": "appinsightsapikey",
</span><span class='line'>        "developerAppInsightsApplicationId": "appinsightsappid",
</span><span class='line'>        "displayName": "The Name of the bot",
</span><span class='line'>        "endpoint": "http://mybot.coffee",
</span><span class='line'>        "iconUrl": "http://myicon",
</span><span class='line'>        "luisAppIds": [
</span><span class='line'>          "luisappid1",
</span><span class='line'>          "luisappid2"
</span><span class='line'>        ],
</span><span class='line'>        "luisKey": "luiskey",
</span><span class='line'>        "msaAppId": "exampleappid"
</span><span class='line'>      }
</span><span class='line'>    }
</span><span class='line'>  },
</span><span class='line'>  "responses": {
</span><span class='line'>    "200": {
</span><span class='line'>      "body": {
</span><span class='line'>        "location": "West US",
</span><span class='line'>        "tags": {
</span><span class='line'>          "tag1": "value1",
</span><span class='line'>          "tag2": "value2"
</span><span class='line'>        },
</span><span class='line'>        "name": "samplename",
</span><span class='line'>        "type": "sampletype",
</span><span class='line'>        "id": "someid",
</span><span class='line'>        "kind": "sdk",
</span><span class='line'>        "etag": "etag1",
</span><span class='line'>        "properties": {
</span><span class='line'>          "description": "The description of the bot",
</span><span class='line'>          "developerAppInsightKey": "appinsightskey",
</span><span class='line'>          "developerAppInsightsApplicationId": "appinsightsappid",
</span><span class='line'>          "displayName": "The Name of the bot",
</span><span class='line'>          "endpoint": "http://mybot.coffee",
</span><span class='line'>          "endpointVersion": "version",
</span><span class='line'>          "iconUrl": "http://myicon",
</span><span class='line'>          "luisAppIds": [
</span><span class='line'>            "luisappid1",
</span><span class='line'>            "luisappid2"
</span><span class='line'>          ],
</span><span class='line'>          "msaAppId": "msaappid",
</span><span class='line'>          "configuredChannels": [
</span><span class='line'>            "facebook",
</span><span class='line'>            "groupme"
</span><span class='line'>          ],
</span><span class='line'>          "enabledChannels": [
</span><span class='line'>            "facebook"
</span><span class='line'>          ]
</span><span class='line'>        }
</span><span class='line'>      }
</span><span class='line'>    },
</span><span class='line'>    "201": {
</span><span class='line'>      "body": {
</span><span class='line'>        "location": "West US",
</span><span class='line'>        "tags": {
</span><span class='line'>          "tag1": "value1",
</span><span class='line'>          "tag2": "value2"
</span><span class='line'>        },
</span><span class='line'>        "name": "samplename",
</span><span class='line'>        "type": "sampletype",
</span><span class='line'>        "id": "someid",
</span><span class='line'>        "kind": "sdk",
</span><span class='line'>        "properties": {
</span><span class='line'>          "description": "The description of the bot",
</span><span class='line'>          "developerAppInsightsApplicationId": "appinsightsappid",
</span><span class='line'>          "displayName": "The Name of the bot",
</span><span class='line'>          "endpoint": "http://mybot.coffee",
</span><span class='line'>          "endpointVersion": "version",
</span><span class='line'>          "iconUrl": "http://myicon",
</span><span class='line'>          "luisAppIds": [
</span><span class='line'>            "luisappid1",
</span><span class='line'>            "luisappid2"
</span><span class='line'>          ],
</span><span class='line'>          "msaAppId": "msaappid",
</span><span class='line'>          "configuredChannels": [
</span><span class='line'>            "facebook",
</span><span class='line'>            "groupme"
</span><span class='line'>          ],
</span><span class='line'>          "enabledChannels": [
</span><span class='line'>            "facebook"
</span><span class='line'>          ]
</span><span class='line'>        }
</span><span class='line'>      }
</span><span class='line'>    }
</span><span class='line'>  }
</span><span class='line'>}
</span><span class='line'>-------- UPDATED EXAMPLE (createbot.json)
</span><span class='line'>{
</span><span class='line'>  "parameters": {
</span><span class='line'>    "subscriptionId": "subscription-id",
</span><span class='line'>    "resourceGroupName": "myResourceGroup",
</span><span class='line'>    "api-version": "2017-01-01",
</span><span class='line'>    "resourceName": "myBot",
</span><span class='line'>    "parameters": {
</span><span class='line'>      "location": "West US",
</span><span class='line'>      "sku": {
</span><span class='line'>        "name": "S1"
</span><span class='line'>      },
</span><span class='line'>      "etag": "etag1",
</span><span class='line'>      "tags": {
</span><span class='line'>        "tag1": "value1",
</span><span class='line'>        "tag2": "value2"
</span><span class='line'>      },
</span><span class='line'>      "name": "samplename",
</span><span class='line'>      "type": "sampletype",
</span><span class='line'>      "id": "someid",
</span><span class='line'>      "kind": "sdk",
</span><span class='line'>      "properties": {
</span><span class='line'>        "description": "The description of the bot",
</span><span class='line'>        "developerAppInsightKey": "appinsightskey",
</span><span class='line'>        "developerAppInsightsApiKey": "appinsightsapikey",
</span><span class='line'>        "developerAppInsightsApplicationId": "appinsightsappid",
</span><span class='line'>        "displayName": "The Name of the bot",
</span><span class='line'>        "endpoint": "http://mybot.coffee",
</span><span class='line'>        "iconUrl": "http://myicon",
</span><span class='line'>        "luisAppIds": [
</span><span class='line'>          "luisappid1",
</span><span class='line'>          "luisappid2"
</span><span class='line'>        ],
</span><span class='line'>        "luisKey": "luiskey",
</span><span class='line'>        "msaAppId": "exampleappid"
</span><span class='line'>      }
</span><span class='line'>    }
</span><span class='line'>  },
</span><span class='line'>  "responses": {
</span><span class='line'>    "200": {
</span><span class='line'>      "body": {
</span><span class='line'>        "location": "West US",
</span><span class='line'>        "tags": {
</span><span class='line'>          "tag1": "value1",
</span><span class='line'>          "tag2": "value2"
</span><span class='line'>        },
</span><span class='line'>        "name": "samplename",
</span><span class='line'>        "type": "sampletype",
</span><span class='line'>        "id": "someid",
</span><span class='line'>        "kind": "sdk",
</span><span class='line'>        "etag": "etag1",
</span><span class='line'>        "properties": {
</span><span class='line'>          "description": "The description of the bot",
</span><span class='line'>          "developerAppInsightKey": "appinsightskey",
</span><span class='line'>          "developerAppInsightsApplicationId": "appinsightsappid",
</span><span class='line'>          "displayName": "The Name of the bot",
</span><span class='line'>          "endpoint": "http://mybot.coffee",
</span><span class='line'>          "endpointVersion": "version",
</span><span class='line'>          "iconUrl": "http://myicon",
</span><span class='line'>          "luisAppIds": [
</span><span class='line'>            "luisappid1",
</span><span class='line'>            "luisappid2"
</span><span class='line'>          ],
</span><span class='line'>          "msaAppId": "msaappid",
</span><span class='line'>          "configuredChannels": [
</span><span class='line'>            "facebook",
</span><span class='line'>            "groupme"
</span><span class='line'>          ],
</span><span class='line'>          "enabledChannels": [
</span><span class='line'>            "facebook"
</span><span class='line'>          ]
</span><span class='line'>        }
</span><span class='line'>      }
</span><span class='line'>    },
</span><span class='line'>    "201": {
</span><span class='line'>      "body": {
</span><span class='line'>        "location": "West US",
</span><span class='line'>        "tags": {
</span><span class='line'>          "tag1": "value1",
</span><span class='line'>          "tag2": "value2"
</span><span class='line'>        },
</span><span class='line'>        "name": "samplename",
</span><span class='line'>        "type": "sampletype",
</span><span class='line'>        "id": "someid",
</span><span class='line'>        "kind": "sdk",
</span><span class='line'>        "properties": {
</span><span class='line'>          "description": "The description of the bot",
</span><span class='line'>          "developerAppInsightsApplicationId": "appinsightsappid",
</span><span class='line'>          "displayName": "The Name of the bot",
</span><span class='line'>          "endpoint": "http://mybot.coffee",
</span><span class='line'>          "endpointVersion": "version",
</span><span class='line'>          "iconUrl": "http://myicon",
</span><span class='line'>          "luisAppIds": [
</span><span class='line'>            "luisappid1",
</span><span class='line'>            "luisappid2"
</span><span class='line'>          ],
</span><span class='line'>          "msaAppId": "msaappid",
</span><span class='line'>          "configuredChannels": [
</span><span class='line'>            "facebook",
</span><span class='line'>            "groupme"
</span><span class='line'>          ],
</span><span class='line'>          "enabledChannels": [
</span><span class='line'>            "facebook"
</span><span class='line'>          ]
</span><span class='line'>        }
</span><span class='line'>      }
</span><span class='line'>    }
</span><span class='line'>  }
</span><span class='line'>}
</span><span class='line'>-------- RESULT
</span><span class='line'>UPDATED: YES
</span><span class='line'>RUN: SUCCESS</span></code></pre></td></tr></table></div></figure>


<h2>Scaffolding Examples</h2>

<h3>Overview</h3>

<p>If example doesn&rsquo;t exist, the tool will allow creating a template based on REST API specs.
In the next step user should update the template and rerun the tool to validate example until it runs correctly.</p>

<h3>Command</h3>

<p><strong>az swagger scaffold &ndash;swagger {location} &ndash;uri {resource-uri} &ndash;method {method} [&ndash;update]</strong></p>

<p><strong>&ndash;example</strong></p>

<p>{location} - either URL of specific swagger json file or path in local</p>

<p><strong>&ndash;uri</strong></p>

<p>Resource URI as appears in swagger specification / documentation.</p>

<p><strong>&ndash;method</strong></p>

<p>Method for which scaffolding should be done, e.g. <strong>put</strong>, <strong>get</strong>, etc&hellip;</p>

<p><strong>&ndash;update</strong></p>

<p>If this option is specified extension will attempt to update existing sample in the local filesystem.
In the future it could create a branch and pull requests directly to the GitHub Repo.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2019/05/22/ansible-and-azure-cli/">Ansible and Azure CLI - Closer Than I Thought</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2019-05-22T11:25:08+08:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>22</span><span class='date-suffix'>nd</span>, <span class='date-year'>2019</span></span> <span class='time'>11:25 am</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><h3>What if&hellip;</h3>

<p>&hellip; Ansible support for Azure was based on <strong>Azure CLI</strong>?</p>

<h2>Similarities and Differences</h2>

<table>
<thead>
<tr>
<th>Item</th>
<th>Azure CLI</th>
<th>Ansible</th>
</tr>
</thead>
<tbody>
<tr>
<td>Implementation</td>
<td>Python/Python SDK</td>
<td>Python/Python SDK</td>
</tr>
<tr>
<td>UX</td>
<td>Azure CLI Options are flattened, simplified and well designed</td>
<td>Ansible options are flattened and we strive to simplify the structure. The level of simplification of Azure CLI is our ultimate goal.</td>
</tr>
<tr>
<td>Error Handling</td>
<td>Excellent. Azure CLI has a lot of checks and gracefully handles critical situations. User can easily create any new resource by reading documentation and reading error responses when something goes wrong.</td>
<td>Poor, if user specifies wrong parameters in most cases module propagates error received from Azure, which in most cases is meaningless</td>
</tr>
<tr>
<td>Idempotence</td>
<td>Not a major goal of Azure CLI, however the idea is that Azure CLI commands should be idempotent</td>
<td>Idempotence is a major feature of Ansible, however we have several implementation problems, for instance not handling non-updatable fiels correctly, not detecting changes in parameters corectly. A lot of inconsistencies in the implementation</td>
</tr>
<tr>
<td>Documentation</td>
<td>Excellent</td>
<td>Good, but sometimes not complete or directly copied from REST API Specification</td>
</tr>
<tr>
<td>Check Mode</td>
<td>NO</td>
<td>YES (see notes on idempotence)</td>
</tr>
<tr>
<td>Coverage</td>
<td>Around 60% of Azure API</td>
<td>Around 12% of Azure API</td>
</tr>
</tbody>
</table>


<h2>How it Could Be Done?</h2>

<p>Implementation could be extremely simple</p>

<p>We could have entire implementation in a single base <strong>az.py</strong> Ansible module to encapsulate <strong>Azure CLI</strong>.</p>

<p>Instead of implementing hundreds of modules for every single resource, we could just have symbolic links to the base module:</p>

<ul>
<li><strong>az_vm.py</strong></li>
<li><strong>az_acr.py</strong></li>
<li><strong>az_vmss.py</strong></li>
</ul>


<p>Base module implementation knows via which link it was loaded, so based on that it can dynamically create:</p>

<ul>
<li>appropriate documentation</li>
<li>appropriate argument spec</li>
<li>handle arguments correctly and call correct commands</li>
</ul>


<p>On the top of that module can:
- recognise which options are updatable by comparing <strong>create</strong> and <strong>update</strong> parameters (using distilled knowledge from Azure CLI)</p>

<h3>How module would work?</h3>

<p>(1) call <strong>az xxx get</strong> to check whether resource exists, get current state
(2) call <strong>az xxx create</strong> or <strong>az xxx update</strong> if resource exists
(3) compare output of initial <strong>get</strong> with output of <strong>update</strong>, to check whether anything has changed</p>

<h2>What&rsquo;s missing?</h2>

<h3>Check Mode</h3>

<p>Check mode is probably the only missing feature that Ansible has (but we are struggling to implement it correctly) and Azure CLI doesn&rsquo;t.</p>

<p>As far as I know Azure CLI is striving to implement idempotency. I need to collect more details on that.</p>

<p>Anyway, a new option called <strong>&ndash;check-mode</strong> would be nice to have.
It could work as follows:</p>

<p>User calls:</p>

<p><strong>az xxxx create &hellip;.. params &hellip;..</strong></p>

<p>Azure CLI calls <strong>get</strong> method on the resource to be created.
Azure CLI prepares the structure to call Python SDK API.
Acure CLI compares structure returned by <strong>get</strong> and structure prepared for <strong>create</strong> call.
If the structures match, return <strong>no change required</strong>, if structures don&rsquo;t match return list of changes detected.</p>

<p>This method would probably work for around 90% of Azure resources, it would fail with</p>

<p>This module would just handle all the interaction with unerlying <strong>Azure CLI</strong>, including:
- handling currently selected subscription if necessary
- handling authentication</p>

<p>On the top of that we could just create symbolic links to that module for every Azure resource, for instance:</p>

<p><strong>az</strong> module knows through which link it was called, so it could generate documentation and argument specification dynamically.</p>

<h3>Benefits</h3>

<ul>
<li>Azure CLI has extremely well maintained UX, which just appears ideal for tools like Ansible</li>
<li>Examples are curated for every resource and well tested</li>
<li>Documentation could be just reused without any changes</li>
</ul>


<h3>What&rsquo;s missing?</h3>

<ul>
<li>idempotence</li>
<li>idempotence</li>
<li>idempotence</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2019/05/14/processing-azure-rest-examples/">Processing Azure REST Examples</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2019-05-14T11:26:13-07:00'><span class='date'><span class='date-month'>May</span> <span class='date-day'>14</span><span class='date-suffix'>th</span>, <span class='date-year'>2019</span></span> <span class='time'>11:26 am</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><h2>Some Issues with Azure REST API Examples</h2>

<ul>
<li>Examples are currently not tested</li>
<li>No naming conventions</li>
<li>Missing Examples (for instance Web App, Function App, I have created missing Resource Group example myself)</li>
<li>No dependencies</li>
</ul>


<h2>Solutions</h2>

<h3>Example naming conventions</h3>

<p>I am using resource URIs to create sample names. For instance:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>network_virtualnetworks_subnets_put.yml
</span><span class='line'>network_virtualnetworks_put.yml
</span><span class='line'>resourcegroups_put.yml</span></code></pre></td></tr></table></div></figure>


<p>This approach makes it easy to find dependencies between examples, which is shown in the demo below.</p>

<h3>Resource naming conventions within samples</h3>

<p>I am overriding names of the resources with names derived from URI pattern.</p>

<p>For instance resource group will be always called <strong>myresourcegroup</strong>, and this makes combining examples trivial.</p>

<h3>Extend Example Validation</h3>

<p>More checks can be introduced to validate examples against actual REST API definition to detect mistakes. I will include more examples here.</p>

<h3>Encourage Reusing REST API Examples Downstream</h3>

<p>Currently examples from REST API are not used directly in any other project. Encouraging usage, testing and contributing fixes upstream would significantly improve REST API specs for everyone.</p>

<h2>What we do in Ansible?</h2>

<p>We are currently developing Autorest / Magic Modules solution to generate Ansible and Terraform modules.</p>

<p>Ansible modules should come with appropriate examples, and also having integration tests are requirement.</p>

<p>Before:</p>

<ul>
<li>examples were usually written manually</li>
<li>examples were sometimes broken or getting outdated</li>
<li>integration tests were written manually</li>
</ul>


<p>Where we are going to do now:</p>

<ul>
<li>we want to have requirement that examples included in the module are <strong>all</strong> included/kept in sync with integration test</li>
<li>examples and integration tests are <strong>not</strong> written manually</li>
</ul>


<p>Benefits:</p>

<ul>
<li>Azure REST API Examples are tested</li>
<li>Examples are fixed/added at the source which is beneficial to everyone</li>
<li>Ensuring that Azure REST API documentation has actually complete/correct examples</li>
<li>Ansible/Terraform documentation has complete and correct examples that are inline with generic Azure documentation</li>
</ul>


<h2>What could be done next?</h2>

<ul>
<li>integrate autorest.devops autorest extension with Azure REST API Specs CI</li>
<li>enforce new rules / possibly generate warnings when necessary?</li>
<li>calculate API score for every resource including example coverage, following naming conventions, etc.</li>
</ul>


<h2>Sample Processed Output</h2>

<h3>Subnet Example</h3>

<p>Below you can see <strong>network_virtualnetworks_subnet_put.yml</strong> example.</p>

<p>On the top you can see that it automatically includes <strong>network_virtualnetworks_put.yml</strong> example that creates virtual network.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>- import_playbook: network_virtualnetworks_put.yml
</span><span class='line'>- hosts: localhost
</span><span class='line'>  roles:
</span><span class='line'>    - ../modules
</span><span class='line'>  vars_files:
</span><span class='line'>    - _vars.yml
</span><span class='line'>  vars:
</span><span class='line'>    resource_group: myresourcegroup
</span><span class='line'>    virtual_network_name: myvirtualnetwork
</span><span class='line'>    subnet_name: mysubnet
</span><span class='line'>  tasks:
</span><span class='line'>    - name: Create subnet
</span><span class='line'>      azure_rm_resource:
</span><span class='line'>        idempotency: yes
</span><span class='line'>        api_version: '2018-02-01'
</span><span class='line'>        polling_timeout: 600
</span><span class='line'>        polling_interval: 30
</span><span class='line'>        # url: /subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Network/virtualNetworks/{virtualNetworkName}/subnets/{subnetName}
</span><span class='line'>        resource_group: '{{ resource_group }}'
</span><span class='line'>        provider: Network
</span><span class='line'>        resource_type: virtualNetworks
</span><span class='line'>        resource_name: "{{ virtual_network_name }}"
</span><span class='line'>        subresource:
</span><span class='line'>          - type: subnets
</span><span class='line'>            name: "{{ subnet_name }}"
</span><span class='line'>        body:
</span><span class='line'>          properties:
</span><span class='line'>            addressPrefix: "10.0.0.0/16"</span></code></pre></td></tr></table></div></figure>


<h3>Virtual Network Example</h3>

<p>Below you can see <strong>network_virtualnetwork_put.yml</strong> example that was referred in previous playbook.</p>

<p>On the top you can see that it automatically includes <strong>resourcegroups_put.yml</strong> example that creates required .</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>- import_playbook: resourcegroups_put.yml
</span><span class='line'>- hosts: localhost
</span><span class='line'>  roles:
</span><span class='line'>    - ../modules
</span><span class='line'>  vars_files:
</span><span class='line'>    - _vars.yml
</span><span class='line'>  vars:
</span><span class='line'>    resource_group: myresourcegroup
</span><span class='line'>    virtual_network_name: myvirtualnetwork
</span><span class='line'>  tasks:
</span><span class='line'>    - name: Create virtual network
</span><span class='line'>      azure_rm_resource:
</span><span class='line'>        idempotency: yes
</span><span class='line'>        api_version: '2018-02-01'
</span><span class='line'>        polling_timeout: 600
</span><span class='line'>        polling_interval: 30
</span><span class='line'>        # url: /subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Network/virtualNetworks/{virtualNetworkName}
</span><span class='line'>        resource_group: '{{ resource_group }}'
</span><span class='line'>        provider: Network
</span><span class='line'>        resource_type: virtualNetworks
</span><span class='line'>        resource_name: "{{ virtual_network_name }}"
</span><span class='line'>        body:
</span><span class='line'>          properties:
</span><span class='line'>            addressSpace:
</span><span class='line'>              addressPrefixes:
</span><span class='line'>                - "10.0.0.0/16"
</span><span class='line'>          location: "eastus"</span></code></pre></td></tr></table></div></figure>


<h3>Resource Group Example</h3>

<p>And finally you can check <strong>resource_groups_put.yml</strong> example that is required by previous playbooks.</p>

<p>On the top you can see that it automatically includes <strong>resourcegroups_put.yml</strong> example that creates required.</p>

<p>You can find a PR here that I have merged to REST API specs:</p>

<p><a href="https://github.com/Azure/azure-rest-api-specs/pull/4971">https://github.com/Azure/azure-rest-api-specs/pull/4971</a></p>

<p>You can find the same example was propagated here to Azure REST API docs:</p>

<p><a href="https://docs.microsoft.com/en-us/rest/api/resources/resourcegroups/createorupdate">https://docs.microsoft.com/en-us/rest/api/resources/resourcegroups/createorupdate</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>- hosts: localhost
</span><span class='line'>  roles:
</span><span class='line'>    - ../modules
</span><span class='line'>  vars_files:
</span><span class='line'>    - _vars.yml
</span><span class='line'>  vars:
</span><span class='line'>    resource_group: myresourcegroup
</span><span class='line'>  tasks:
</span><span class='line'>    - name: Create or update a resource group.
</span><span class='line'>      azure_rm_resource:
</span><span class='line'>        idempotency: yes
</span><span class='line'>        api_version: '2018-05-01'
</span><span class='line'>        # url: /subscriptions/{subscriptionId}/resourcegroups/{resourceGroupName}
</span><span class='line'>        resource_group: '{{ resource_group }}'
</span><span class='line'>        body:
</span><span class='line'>          location: eastus</span></code></pre></td></tr></table></div></figure>


<h2>Demo</h2>

<h3>Prerequisites</h3>

<p>Ansible 2.8</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>pip install ansible[azure]</span></code></pre></td></tr></table></div></figure>


<p>Clone sample repository:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git clone https://github.com/zikalino/ansible-azure-rest-examples.git
</span><span class='line'>cd examples</span></code></pre></td></tr></table></div></figure>


<h3>Running Examples Demo</h3>

<p>From examples folder run:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ansible-playbook network_virtual_networks_subnet_put.yml</span></code></pre></td></tr></table></div></figure>


<p>You should see that all dependencies and subnet are correctly created:</p>

<p><img src="/images/running-examples.png" alt="Running Examples Demo" /></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2019/03/27/creating-azure-function-app-using-rest-api/">Creating Azure Function App Using REST API</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2019-03-27T13:47:38+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2019</span></span> <span class='time'>1:47 pm</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>Finally I got it working&hellip;</p>

<p>I used appservice plan as created in my previous post:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>az appservice plan create --name myplan -g zimsfromclixx --is-linux --location westeurope --sku S1 --number-of-workers 1
</span></code></pre></td></tr></table></div></figure>


<p>and updated my task to refer that Linux-enabled plan (<strong>serverFarmId</strong>):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>- name: Create Function App using REST API
</span><span class='line'>  azure_rm_resource:
</span><span class='line'>    api_version: <span class="s1">&#39;2018-02-01&#39;</span>
</span><span class='line'>    resource_group: <span class="s2">&quot;&quot;</span>
</span><span class='line'>    provider: web
</span><span class='line'>    resource_type: sites
</span><span class='line'>    resource_name: <span class="s2">&quot;&quot;</span>
</span><span class='line'>    body:
</span><span class='line'>      kind: functionapp,linux,container
</span><span class='line'>      properties:
</span><span class='line'>        siteConfig:
</span><span class='line'>          appSettings:
</span><span class='line'>            - name: FUNCTIONS_EXTENSION_VERSION
</span><span class='line'>              value<span class="s1">&#39;: &#39;</span>~2<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">            - name: DOCKER_REGISTRY_SERVER_URL</span>
</span><span class='line'><span class="s1">              value: &#39;</span>https://index.docker.io<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">          linuxFxVersion: &#39;</span>DOCKER<span class="p">|</span>httpd<span class="err">&#39;</span>
</span><span class='line'>        serverFarmId: /subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/zimsfromclixx/providers/Microsoft.Web/serverFarms/myplan
</span><span class='line'>      location: eastus
</span></code></pre></td></tr></table></div></figure>


<p>Task is pretty simple, and I guess it may be simplified even further. I plan to create full sample, and add apropriate updates to <strong>azure_rm_functionapp</strong> module.
Plus I will create a new sample for Azure REST API specification. That was at least two days of work to get here&hellip;.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2019/03/27/creating-container-based-function-app-using-azure-cli/">Creating Container Based Function App Using Azure CLI</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2019-03-27T12:53:55+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2019</span></span> <span class='time'>12:53 pm</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>It&rsquo;s just a few lines of code, but took me some time to do it by trial and error.</p>

<p>Just a few steps:</p>

<p>(1) create resource group</p>

<p>(2) create storage account</p>

<p>(3) create appservice plan with <strong>is_linux</strong> option</p>

<p>(4) create function app and specify container image <strong>httpd</strong> from DockerHub</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>az group create --name zimsfromclixx --location westeurope
</span><span class='line'>
</span><span class='line'>az storage account create --name zimsstoragefromclixx --location westeurope --resource-group zimsfromclixx --sku Standard_LRS
</span><span class='line'>
</span><span class='line'>az appservice plan create --name myplan -g zimsfromclixx --is-linux --location westeurope --sku S1 --number-of-workers 1
</span><span class='line'>
</span><span class='line'>az functionapp create --resource-group zimsfromclixx --os-type Linux --plan myplan --name zimsfromclixx --deployment-container-image-name httpd --storage-account zimsstoragefromclixx
</span></code></pre></td></tr></table></div></figure>


<p>Just run the commands using Azure CLI, go to the browser and enter <a href="https://zimsfromclixx.azurewebsites.net/">https://zimsfromclixx.azurewebsites.net/</a> (you may use your own functionapp name here), and you should see standard Apache&rsquo;s **It Works!!&ldquo; welcome page.</p>

<p>Sounds easy, however when creating functionapp, <strong>&ndash;plan</strong> argument is not obligatory, and if you omit step (3) and <strong>&ndash;plan</strong> argument, default plan will be created, and with default plan you can&rsquo;t use containers. It took me some time to figure out&hellip;.</p>

<p>Also some people run into similar problem, for instance here:</p>

<p><a href="https://github.com/Azure/azure-cli/issues/7426">https://github.com/Azure/azure-cli/issues/7426</a></p>

<p>In fact only this PR helped me to understand how Azure CLI works:</p>

<p><a href="https://github.com/Azure/azure-cli/pull/7435/files">https://github.com/Azure/azure-cli/pull/7435/files</a></p>

<p>When you try to specify <strong>&ndash;deployment-container-image-name httpd</strong> without passing <strong>&ndash;plan</strong> that is <strong>is_linux</strong>, Azure CLI resoponds with following message, which is quite misleading:</p>

<p><strong>usage error: &ndash;runtime RUNTIME required for linux functions apps without custom image.</strong></p>

<p>I submitted issue to Azure CLI regarding this: <a href="https://github.com/Azure/azure-cli/issues/8889">https://github.com/Azure/azure-cli/issues/8889</a></p>

<p>Finally, here&rsquo;s a link to some documentation I found later:</p>

<p><a href="https://docs.microsoft.com/en-us/azure/app-service/containers/app-service-linux-cli">https://docs.microsoft.com/en-us/azure/app-service/containers/app-service-linux-cli</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2019/03/25/coming-rename-of-facts-modules-to-info-modules/">Coming Rename of _facts Modules to _info Modules</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2019-03-25T13:24:19+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>25</span><span class='date-suffix'>th</span>, <span class='date-year'>2019</span></span> <span class='time'>1:24 pm</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>It requires some statistics on what needs to be done:</p>

<table>
<thead>
<tr>
<th>Module Name</th>
<th>Status</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td>azure_rm_aks_facts</td>
<td>2.6</td>
<td>** needs upgrade</td>
</tr>
<tr>
<td>azure_rm_applicationsecuritygroup_facts</td>
<td>2.8</td>
<td>rename</td>
</tr>
<tr>
<td>azure_rm_appserviceplan_facts</td>
<td>2.7</td>
<td>rename/obsolete</td>
</tr>
<tr>
<td>azure_rm_autoscale_facts</td>
<td>2.7</td>
<td>rename/obsolete</td>
</tr>
<tr>
<td>azure_rm_availabilityset_facts</td>
<td>OLD</td>
<td>** needs upgrade</td>
</tr>
<tr>
<td>azure_rm_cdnendpoint_facts</td>
<td>2.8</td>
<td>rename</td>
</tr>
<tr>
<td>azure_rm_cdnprofile_facts</td>
<td>2.8</td>
<td>rename</td>
</tr>
<tr>
<td>azure_rm_containerinstance_facts</td>
<td>2.8</td>
<td>rename</td>
</tr>
<tr>
<td>azure_rm_containerregistry_facts</td>
<td>2.7</td>
<td>rename/obsolete</td>
</tr>
<tr>
<td>azure_rm_cosmosdbaccount_facts</td>
<td>2.8</td>
<td>rename</td>
</tr>
<tr>
<td>azure_rm_deployment_facts</td>
<td>2.8</td>
<td>rename</td>
</tr>
<tr>
<td>azure_rm_devtestlabarmtemplate_facts</td>
<td>2.8</td>
<td>rename</td>
</tr>
<tr>
<td>azure_rm_devtestlabartifactsource_facts</td>
<td>2.8</td>
<td>rename</td>
</tr>
<tr>
<td>azure_rm_devtestlabartifact_facts</td>
<td>2.8</td>
<td>rename</td>
</tr>
<tr>
<td>azure_rm_devtestlabcustomimage_facts</td>
<td>2.8</td>
<td>rename</td>
</tr>
<tr>
<td>azure_rm_devtestlabenvironment_facts</td>
<td>2.8</td>
<td>rename</td>
</tr>
<tr>
<td>azure_rm_devtestlabartifact_facts</td>
<td>2.8</td>
<td>rename</td>
</tr>
<tr>
<td>azure_rm_devtestlabpolicy_facts</td>
<td>2.8</td>
<td>rename</td>
</tr>
<tr>
<td>azure_rm_devtestlabvirtualmachine_facts</td>
<td>2.8</td>
<td>rename</td>
</tr>
<tr>
<td>azure_rm_devtestlabvirtualnetwork_facts</td>
<td>2.8</td>
<td>rename</td>
</tr>
<tr>
<td>azure_rm_devtestlab_facts</td>
<td>2.8</td>
<td>rename</td>
</tr>
<tr>
<td>azure_rm_dnsrecordset_facts</td>
<td>OLD/SPLIT</td>
<td>split/obsolete</td>
</tr>
<tr>
<td>azure_rm_dnszone_facts</td>
<td>OLD/SPLIT</td>
<td>split/obsolete</td>
</tr>
<tr>
<td>azure_rm_functionapp_facts</td>
<td>OLD</td>
<td>** needs upgrade</td>
</tr>
<tr>
<td>azure_rm_hdinsight_facts</td>
<td>2.8</td>
<td>rename</td>
</tr>
<tr>
<td>azure_rm_image_facts</td>
<td>2.8</td>
<td>rename</td>
</tr>
<tr>
<td>azure_rm_loadbalancer_facts</td>
<td>OLD</td>
<td>** needs upgrade</td>
</tr>
<tr>
<td>azure_rm_managed_disk_facts</td>
<td>OLD</td>
<td>** needs upgrade</td>
</tr>
<tr>
<td>azure_rm_mariadbconfiguration_facts</td>
<td>2.8</td>
<td>rename</td>
</tr>
<tr>
<td>azure_rm_mariadbdatabase_facts</td>
<td>2.8</td>
<td>rename</td>
</tr>
<tr>
<td>azure_rm_mariadbfirewallrule_facts</td>
<td>2.8</td>
<td>rename</td>
</tr>
<tr>
<td>azure_rm_mariadbserver_facts</td>
<td>2.8</td>
<td>rename</td>
</tr>
<tr>
<td>azure_rm_mysqlconfiguration_facts</td>
<td>2.8</td>
<td>rename</td>
</tr>
<tr>
<td>azure_rm_mysqldatabase_facts</td>
<td></td>
<td>rename/obsolete</td>
</tr>
<tr>
<td>azure_rm_mysqlfirewallrule_facts</td>
<td>2.8</td>
<td>rename</td>
</tr>
<tr>
<td>azure_rm_mysqlserver_facts</td>
<td></td>
<td>rename/obsolete</td>
</tr>
<tr>
<td>azure_rm_networkinterface_facts</td>
<td>OLD/SPLIT</td>
<td>split/obsolete</td>
</tr>
<tr>
<td>azure_rm_postgresqlconfiguration_facts</td>
<td>2.8</td>
<td>rename</td>
</tr>
<tr>
<td>azure_rm_postgresqldatabase_facts</td>
<td></td>
<td>rename/obsolete</td>
</tr>
<tr>
<td>azure_rm_postgresqlfirewallrule_facts</td>
<td>2.8</td>
<td>rename</td>
</tr>
<tr>
<td>azure_rm_postgresqlserver_facts</td>
<td></td>
<td>rename/obsolete</td>
</tr>
<tr>
<td>azure_rm_publicipaddress_facts</td>
<td>OLD/SPLIT</td>
<td>split/obsolete</td>
</tr>
<tr>
<td>azure_rm_rediscache_facts</td>
<td>2.8</td>
<td>rename</td>
</tr>
<tr>
<td>azure_rm_resourcegroup_facts</td>
<td>OLD</td>
<td>** needs upgrade</td>
</tr>
<tr>
<td>azure_rm_resource_facts</td>
<td>2.6</td>
<td>rename/obsolete</td>
</tr>
<tr>
<td>azure_rm_roleassignment_facts</td>
<td>2.8</td>
<td>rename</td>
</tr>
<tr>
<td>azure_rm_roledefinition_facts</td>
<td>2.8</td>
<td>rename</td>
</tr>
<tr>
<td>azure_rm_routetable_facts</td>
<td>2.7</td>
<td>rename/obsolete</td>
</tr>
<tr>
<td>azure_rm_securitygroup_facts</td>
<td>OLD</td>
<td>** needs upgrade</td>
</tr>
<tr>
<td>azure_rm_sqldatabase_facts</td>
<td>2.8</td>
<td>rename</td>
</tr>
<tr>
<td>azure_rm_sqlfirewallrule_facts</td>
<td>2.8</td>
<td>rename</td>
</tr>
<tr>
<td>azure_rm_sqlserver_facts</td>
<td></td>
<td>** needs upgrade</td>
</tr>
<tr>
<td>azure_rm_subnet_facts</td>
<td>2.8</td>
<td>rename</td>
</tr>
<tr>
<td>azure_rm_storageaccount_facts</td>
<td>OLD/SPLIT?</td>
<td>split/obsolete</td>
</tr>
<tr>
<td>azure_rm_trafficmanagerendpoint_facts</td>
<td></td>
<td>rename/obsolete</td>
</tr>
<tr>
<td>azure_rm_trafficmanagerprofile_facts</td>
<td></td>
<td>rename/obsolete</td>
</tr>
<tr>
<td>azure_rm_virtualmachineextension_facts</td>
<td>2.8</td>
<td>rename</td>
</tr>
<tr>
<td>azure_rm_virtualmachineimage_facts</td>
<td>OLD</td>
<td>** needs upgrade</td>
</tr>
<tr>
<td>azure_rm_virtualmachinescalesetextension_facts</td>
<td>2.8</td>
<td>rename</td>
</tr>
<tr>
<td>azure_rm_virtualmachinescalesetinstance_facts</td>
<td>2.8</td>
<td>rename</td>
</tr>
<tr>
<td>azure_rm_virtualmachine_facts</td>
<td>2.7</td>
<td>rename/obsolete</td>
</tr>
<tr>
<td>azure_rm_virtualmachine_scaleset_facts</td>
<td>OLD/SPLIT</td>
<td>split/obsolete</td>
</tr>
<tr>
<td>azure_rm_virtualnetwork_facts</td>
<td>OLD/SPLIT</td>
<td>split/obsolete</td>
</tr>
<tr>
<td>azure_rm_webapp_facts</td>
<td>2.7</td>
<td>rename/obsolete</td>
</tr>
</tbody>
</table>


<p>From above:</p>

<p><strong>needs upgrade</strong> - these modules need new <em>curated</em> version (9 modules)</p>

<p><strong>split/obsolete</strong> - these modules alerady have <em>curated</em> format, need to be split (7 modules)</p>

<p><strong>rename/obsolete</strong> - these modules were introduced before 2.8 and we need to rename them and made old version available via symbolic link and obsolete (14 modules)</p>

<p><strong>rename</strong> - these modules we introduced in Ansible 2.8, meaning they are not release them, meaning we can release them before freeze (around 35 modules)</p>

<h2>Impact on Sample Playbooks</h2>

<ul>
<li>we need to rename <strong>facts</strong> to <strong>info</strong> in all playbooks referring to new 2.8 facts modules</li>
<li>we have more then 1 year timeframe for older <strong>facts</strong> modules as they will be marked as obsolete</li>
</ul>


<h2>Impact on users</h2>

<ul>
<li>for all the new 2.8 modules they will see only new <strong>info</strong> modules, so there&rsquo;s no impact</li>
<li>for older <strong>facts</strong> modules they can use either <strong>facts</strong> or <strong>info</strong>, if they use <strong>facts</strong> they will be encouraged to switch to new <strong>info</strong> modules, also impact is minimal</li>
<li>they will have a year to change</li>
</ul>


<h2>Impact on test</h2>

<ul>
<li>same tests executed on new <strong>info</strong> modules as old <em>*facts</em> modules</li>
<li>in most cases <strong>facts</strong> modules will be symbolic links to <strong>info</strong> modules, so content will be the same</li>
<li>for oldest modules, we can disable tests for old <strong>fact</strong> or we can test both <strong>facts</strong> and <strong>info</strong></li>
</ul>


<h2>Impact on azure_preview_modules</h2>

<ul>
<li>no impact, we will just copy all the updated from devel, as usual</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2019/03/22/dumping-all-the-resources-in-resource-group-using-ansible/">Dumping All the Resources in Resource Group Using Ansible</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2019-03-22T15:25:37+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>22</span><span class='date-suffix'>nd</span>, <span class='date-year'>2019</span></span> <span class='time'>3:25 pm</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>Now, this is pretty cool. With a very small Ansible playbook you can dump entire content of a Resource Group.</p>

<p>Please note it requires Ansible 2.8.</p>

<h2>Running the Example</h2>

<p>The example is now available in official <strong>Azure-Samples</strong>:</p>

<pre><code>https://github.com/Azure-Samples/ansible-playbooks/blob/master/rest/resourcegroup_dump_resources.yml
</code></pre>

<h2>The Playbook</h2>

<p>The playbook uses <strong>azure_rm_resource_facts</strong> module and does following steps:</p>

<ul>
<li>retrieve list of all of the resources in the resource group</li>
<li>dump list of resources</li>
<li>create list of resource ids</li>
<li>dump list of resource ids</li>
<li>iterate through resource ids and retrieve details of each resource</li>
<li>convert output to single list of all resources</li>
<li>dump detailed list of resources</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">List all the resources under a resource group</span>
</span><span class='line'>  <span class="l-Scalar-Plain">azure_rm_resource_facts</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">resource_group</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">zimsdtl</span>
</span><span class='line'>    <span class="l-Scalar-Plain">resource_type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">resources</span>
</span><span class='line'>  <span class="l-Scalar-Plain">register</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">output</span>
</span><span class='line'>
</span><span class='line'><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Dump raw list of resouces in the resource group</span>
</span><span class='line'>  <span class="l-Scalar-Plain">debug</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">var</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">output</span>
</span><span class='line'>
</span><span class='line'><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Create a list of resource IDs</span>
</span><span class='line'>  <span class="l-Scalar-Plain">set_fact</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">resource_ids</span><span class="p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">output.response</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">map(attribute=&#39;id&#39;)</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">list</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Dump list of resource IDs</span>
</span><span class='line'>  <span class="l-Scalar-Plain">debug</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">var</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">resource_ids</span>
</span><span class='line'>
</span><span class='line'><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Iterate through the resources and query details on each one</span>
</span><span class='line'>  <span class="l-Scalar-Plain">azure_rm_resource_facts</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">url</span><span class="p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span class='line'>  <span class="l-Scalar-Plain">register</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">output</span>
</span><span class='line'>  <span class="l-Scalar-Plain">with_items</span><span class="p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">resource_ids</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Create single list of resources</span>
</span><span class='line'>  <span class="l-Scalar-Plain">set_fact</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">resources</span><span class="p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">output.results</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">map(attribute=&#39;response&#39;)</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">sum(start=[])</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Dump final list of resources</span>
</span><span class='line'>  <span class="l-Scalar-Plain">debug</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">var</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">resources</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Final Output</h2>

<p>And final output looks like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
<span class='line-number'>231</span>
<span class='line-number'>232</span>
<span class='line-number'>233</span>
<span class='line-number'>234</span>
<span class='line-number'>235</span>
<span class='line-number'>236</span>
<span class='line-number'>237</span>
<span class='line-number'>238</span>
<span class='line-number'>239</span>
<span class='line-number'>240</span>
<span class='line-number'>241</span>
<span class='line-number'>242</span>
<span class='line-number'>243</span>
<span class='line-number'>244</span>
<span class='line-number'>245</span>
<span class='line-number'>246</span>
<span class='line-number'>247</span>
<span class='line-number'>248</span>
<span class='line-number'>249</span>
<span class='line-number'>250</span>
<span class='line-number'>251</span>
<span class='line-number'>252</span>
<span class='line-number'>253</span>
<span class='line-number'>254</span>
<span class='line-number'>255</span>
<span class='line-number'>256</span>
<span class='line-number'>257</span>
<span class='line-number'>258</span>
<span class='line-number'>259</span>
<span class='line-number'>260</span>
<span class='line-number'>261</span>
<span class='line-number'>262</span>
<span class='line-number'>263</span>
<span class='line-number'>264</span>
<span class='line-number'>265</span>
<span class='line-number'>266</span>
<span class='line-number'>267</span>
<span class='line-number'>268</span>
<span class='line-number'>269</span>
<span class='line-number'>270</span>
<span class='line-number'>271</span>
<span class='line-number'>272</span>
<span class='line-number'>273</span>
<span class='line-number'>274</span>
<span class='line-number'>275</span>
<span class='line-number'>276</span>
<span class='line-number'>277</span>
<span class='line-number'>278</span>
<span class='line-number'>279</span>
<span class='line-number'>280</span>
<span class='line-number'>281</span>
<span class='line-number'>282</span>
<span class='line-number'>283</span>
<span class='line-number'>284</span>
<span class='line-number'>285</span>
<span class='line-number'>286</span>
<span class='line-number'>287</span>
<span class='line-number'>288</span>
<span class='line-number'>289</span>
<span class='line-number'>290</span>
<span class='line-number'>291</span>
<span class='line-number'>292</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">PLAY [List all resources in resource group] *********************************************************************************************************************************************</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">TASK [Gathering Facts] ******************************************************************************************************************************************************************</span>
</span><span class='line'><span class="l-Scalar-Plain">ok</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">localhost</span><span class="p-Indicator">]</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">TASK [List all the resources under a resource group] ************************************************************************************************************************************</span>
</span><span class='line'> <span class="l-Scalar-Plain">[WARNING]</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Azure API profile latest does not define an entry for GenericRestClient</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">ok</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">localhost</span><span class="p-Indicator">]</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">TASK [Dump raw list of resouces in the resource group] **********************************************************************************************************************************</span>
</span><span class='line'><span class="l-Scalar-Plain">ok</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">localhost</span><span class="p-Indicator">]</span> <span class="l-Scalar-Plain">=&gt; {</span>
</span><span class='line'>    <span class="l-Scalar-Plain">&quot;output&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span>
</span><span class='line'>        <span class="s">&quot;changed&quot;</span><span class="p-Indicator">:</span> <span class="nv">false</span><span class="p-Indicator">,</span>
</span><span class='line'>        <span class="s">&quot;failed&quot;</span><span class="p-Indicator">:</span> <span class="nv">false</span><span class="p-Indicator">,</span>
</span><span class='line'>        <span class="s">&quot;response&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span>
</span><span class='line'>            <span class="p-Indicator">{</span>
</span><span class='line'>                <span class="s">&quot;id&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/zimsdtl/providers/Microsoft.DevTestLab/labs/labxxxx&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;location&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;eastus&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;name&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;labxxxx&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;type&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;Microsoft.DevTestLab/labs&quot;</span>
</span><span class='line'>            <span class="p-Indicator">},</span>
</span><span class='line'>            <span class="p-Indicator">{</span>
</span><span class='line'>                <span class="s">&quot;id&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/zimsdtl/providers/Microsoft.DevTestLab/labs/labxxxx/virtualMachines/vmxxxx&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;location&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;eastus&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;name&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;labxxxx/vmxxxx&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;type&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;Microsoft.DevTestLab/labs/virtualMachines&quot;</span>
</span><span class='line'>            <span class="p-Indicator">},</span>
</span><span class='line'>            <span class="p-Indicator">{</span>
</span><span class='line'>                <span class="s">&quot;id&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/zimsdtl/providers/Microsoft.KeyVault/vaults/labxxxx9607&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;location&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;eastus&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;name&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;labxxxx9607&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;tags&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span>
</span><span class='line'>                    <span class="s">&quot;CreatedBy&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;DevTestLabs&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                    <span class="s">&quot;hidden-DevTestLabs-LabUId&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;1f33aff8-4e19-43e2-b2fc-181ce85afd2a&quot;</span>
</span><span class='line'>                <span class="p-Indicator">},</span>
</span><span class='line'>                <span class="s">&quot;type&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;Microsoft.KeyVault/vaults&quot;</span>
</span><span class='line'>            <span class="p-Indicator">},</span>
</span><span class='line'>            <span class="p-Indicator">{</span>
</span><span class='line'>                <span class="s">&quot;id&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/zimsdtl/providers/Microsoft.Network/virtualNetworks/vnxxxx&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;location&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;eastus&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;name&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;vnxxxx&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;tags&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span>
</span><span class='line'>                    <span class="s">&quot;hidden-DevTestLabs-LabUId&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;1f33aff8-4e19-43e2-b2fc-181ce85afd2a&quot;</span>
</span><span class='line'>                <span class="p-Indicator">},</span>
</span><span class='line'>                <span class="s">&quot;type&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;Microsoft.Network/virtualNetworks&quot;</span>
</span><span class='line'>            <span class="p-Indicator">},</span>
</span><span class='line'>            <span class="p-Indicator">{</span>
</span><span class='line'>                <span class="s">&quot;id&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/zimsdtl/providers/Microsoft.Storage/storageAccounts/alabxxxx2409&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;kind&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;StorageV2&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;location&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;eastus&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;name&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;alabxxxx2409&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;sku&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span>
</span><span class='line'>                    <span class="s">&quot;name&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;Standard_LRS&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                    <span class="s">&quot;tier&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;Standard&quot;</span>
</span><span class='line'>                <span class="p-Indicator">},</span>
</span><span class='line'>                <span class="s">&quot;tags&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span>
</span><span class='line'>                    <span class="s">&quot;hidden-DevTestLabs-LabUId&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;1f33aff8-4e19-43e2-b2fc-181ce85afd2a&quot;</span>
</span><span class='line'>                <span class="p-Indicator">},</span>
</span><span class='line'>                <span class="s">&quot;type&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;Microsoft.Storage/storageAccounts&quot;</span>
</span><span class='line'>            <span class="p-Indicator">}</span>
</span><span class='line'>        <span class="p-Indicator">],</span>
</span><span class='line'>        <span class="s">&quot;url&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/zimsdtl/resources&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>        <span class="s">&quot;warnings&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span>
</span><span class='line'>            <span class="s">&quot;Azure</span><span class="nv"> </span><span class="s">API</span><span class="nv"> </span><span class="s">profile</span><span class="nv"> </span><span class="s">latest</span><span class="nv"> </span><span class="s">does</span><span class="nv"> </span><span class="s">not</span><span class="nv"> </span><span class="s">define</span><span class="nv"> </span><span class="s">an</span><span class="nv"> </span><span class="s">entry</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">GenericRestClient&quot;</span>
</span><span class='line'>        <span class="p-Indicator">]</span>
</span><span class='line'>    <span class="p-Indicator">}</span>
</span><span class='line'><span class="err">}</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">TASK [Create a list of resource IDs] ****************************************************************************************************************************************************</span>
</span><span class='line'><span class="l-Scalar-Plain">ok</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">localhost</span><span class="p-Indicator">]</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">TASK [Dump list of resource IDs] ********************************************************************************************************************************************************</span>
</span><span class='line'><span class="l-Scalar-Plain">ok</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">localhost</span><span class="p-Indicator">]</span> <span class="l-Scalar-Plain">=&gt; {</span>
</span><span class='line'>    <span class="l-Scalar-Plain">&quot;resource_ids&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span>
</span><span class='line'>        <span class="s">&quot;/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/zimsdtl/providers/Microsoft.DevTestLab/labs/labxxxx&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>        <span class="s">&quot;/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/zimsdtl/providers/Microsoft.DevTestLab/labs/labxxxx/virtualMachines/vmxxxx&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>        <span class="s">&quot;/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/zimsdtl/providers/Microsoft.KeyVault/vaults/labxxxx9607&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>        <span class="s">&quot;/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/zimsdtl/providers/Microsoft.Network/virtualNetworks/vnxxxx&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>        <span class="s">&quot;/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/zimsdtl/providers/Microsoft.Storage/storageAccounts/alabxxxx2409&quot;</span>
</span><span class='line'>    <span class="p-Indicator">]</span>
</span><span class='line'><span class="err">}</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">TASK [Iterate through the resources and query details on each one] **********************************************************************************************************************</span>
</span><span class='line'><span class="l-Scalar-Plain">ok</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">localhost</span><span class="p-Indicator">]</span> <span class="l-Scalar-Plain">=&gt; (item=/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/zimsdtl/providers/Microsoft.DevTestLab/labs/labxxxx)</span>
</span><span class='line'><span class="l-Scalar-Plain">ok</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">localhost</span><span class="p-Indicator">]</span> <span class="l-Scalar-Plain">=&gt; (item=/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/zimsdtl/providers/Microsoft.DevTestLab/labs/labxxxx/virtualMachines/vmxxxx)</span>
</span><span class='line'><span class="l-Scalar-Plain">ok</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">localhost</span><span class="p-Indicator">]</span> <span class="l-Scalar-Plain">=&gt; (item=/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/zimsdtl/providers/Microsoft.KeyVault/vaults/labxxxx9607)</span>
</span><span class='line'><span class="l-Scalar-Plain">ok</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">localhost</span><span class="p-Indicator">]</span> <span class="l-Scalar-Plain">=&gt; (item=/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/zimsdtl/providers/Microsoft.Network/virtualNetworks/vnxxxx)</span>
</span><span class='line'><span class="l-Scalar-Plain">ok</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">localhost</span><span class="p-Indicator">]</span> <span class="l-Scalar-Plain">=&gt; (item=/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/zimsdtl/providers/Microsoft.Storage/storageAccounts/alabxxxx2409)</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">TASK [Create single list of resources] **************************************************************************************************************************************************</span>
</span><span class='line'><span class="l-Scalar-Plain">ok</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">localhost</span><span class="p-Indicator">]</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">TASK [Dump final list of resources] *****************************************************************************************************************************************************</span>
</span><span class='line'><span class="l-Scalar-Plain">ok</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">localhost</span><span class="p-Indicator">]</span> <span class="l-Scalar-Plain">=&gt; {</span>
</span><span class='line'>    <span class="l-Scalar-Plain">&quot;resources&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span>
</span><span class='line'>        <span class="p-Indicator">{</span>
</span><span class='line'>            <span class="s">&quot;id&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourcegroups/zimsdtl/providers/microsoft.devtestlab/labs/labxxxx&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>            <span class="s">&quot;location&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;eastus&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>            <span class="s">&quot;name&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;labxxxx&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>            <span class="s">&quot;properties&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span>
</span><span class='line'>                <span class="s">&quot;announcement&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span>
</span><span class='line'>                    <span class="s">&quot;enabled&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;Disabled&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                    <span class="s">&quot;expired&quot;</span><span class="p-Indicator">:</span> <span class="nv">false</span><span class="p-Indicator">,</span>
</span><span class='line'>                    <span class="s">&quot;markdown&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                    <span class="s">&quot;title&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;&quot;</span>
</span><span class='line'>                <span class="p-Indicator">},</span>
</span><span class='line'>                <span class="s">&quot;artifactsStorageAccount&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/zimsdtl/providers/Microsoft.Storage/storageAccounts/alabxxxx2409&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;createdDate&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;2019-03-01T08:42:35.4625319+00:00&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;defaultPremiumStorageAccount&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/zimsdtl/providers/Microsoft.Storage/storageAccounts/alabxxxx2409&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;defaultStorageAccount&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/zimsdtl/providers/Microsoft.Storage/storageAccounts/alabxxxx2409&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;environmentPermission&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;Reader&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;labStorageType&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;Standard&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;mandatoryArtifactsResourceIdsLinux&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">[],</span>
</span><span class='line'>                <span class="s">&quot;mandatoryArtifactsResourceIdsWindows&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">[],</span>
</span><span class='line'>                <span class="s">&quot;premiumDataDiskStorageAccount&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/zimsdtl/providers/Microsoft.Storage/storageAccounts/alabxxxx2409&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;premiumDataDisks&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;Disabled&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;provisioningState&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;Succeeded&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;support&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span>
</span><span class='line'>                    <span class="s">&quot;enabled&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;Disabled&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                    <span class="s">&quot;markdown&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;&quot;</span>
</span><span class='line'>                <span class="p-Indicator">},</span>
</span><span class='line'>                <span class="s">&quot;uniqueIdentifier&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;1f33aff8-4e19-43e2-b2fc-181ce85afd2a&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;vaultName&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/zimsdtl/providers/Microsoft.KeyVault/vaults/labxxxx9607&quot;</span>
</span><span class='line'>            <span class="p-Indicator">},</span>
</span><span class='line'>            <span class="s">&quot;type&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;Microsoft.DevTestLab/labs&quot;</span>
</span><span class='line'>        <span class="p-Indicator">},</span>
</span><span class='line'>        <span class="p-Indicator">{</span>
</span><span class='line'>            <span class="s">&quot;id&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourcegroups/zimsdtl/providers/microsoft.devtestlab/labs/labxxxx/virtualmachines/vmxxxx&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>            <span class="s">&quot;location&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;eastus&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>            <span class="s">&quot;name&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;vmxxxx&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>            <span class="s">&quot;properties&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span>
</span><span class='line'>                <span class="s">&quot;allowClaim&quot;</span><span class="p-Indicator">:</span> <span class="nv">false</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;artifactDeploymentStatus&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span>
</span><span class='line'>                    <span class="s">&quot;artifactsApplied&quot;</span><span class="p-Indicator">:</span> <span class="nv">0</span><span class="p-Indicator">,</span>
</span><span class='line'>                    <span class="s">&quot;totalArtifacts&quot;</span><span class="p-Indicator">:</span> <span class="nv">0</span>
</span><span class='line'>                <span class="p-Indicator">},</span>
</span><span class='line'>                <span class="s">&quot;computeId&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/labxxxx-vmxxxx-561112/providers/Microsoft.Compute/virtualMachines/vmxxxx&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;createdByUser&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;createdByUserId&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;createdDate&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;2019-03-01T08:44:56.9375632+00:00&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;dataDiskParameters&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">[],</span>
</span><span class='line'>                <span class="s">&quot;disallowPublicIpAddress&quot;</span><span class="p-Indicator">:</span> <span class="nv">false</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;expirationDate&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;2029-02-22T01:49:12.117974+00:00&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;fqdn&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;vmxxxx.eastus.cloudapp.azure.com&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;galleryImageReference&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span>
</span><span class='line'>                    <span class="s">&quot;offer&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;UbuntuServer&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                    <span class="s">&quot;osType&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;Linux&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                    <span class="s">&quot;publisher&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;Canonical&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                    <span class="s">&quot;sku&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;16.04-LTS&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                    <span class="s">&quot;version&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;latest&quot;</span>
</span><span class='line'>                <span class="p-Indicator">},</span>
</span><span class='line'>                <span class="s">&quot;labSubnetName&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;vnxxxxSubnet&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;labVirtualNetworkId&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/zimsdtl/providers/Microsoft.DevTestLab/labs/labxxxx/virtualnetworks/vnxxxx&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;lastKnownPowerState&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;Stopped&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;networkInterface&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">{},</span>
</span><span class='line'>                <span class="s">&quot;notes&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;Virtual</span><span class="nv"> </span><span class="s">machine</span><span class="nv"> </span><span class="s">notes,</span><span class="nv"> </span><span class="s">just</span><span class="nv"> </span><span class="s">something....&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;osType&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;Linux&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;ownerObjectId&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;20d81029-94cd-4923-a766-994415ff73bd&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;ownerUserPrincipalName&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;provisioningState&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;Succeeded&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;size&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;Standard_A2_v2&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;storageType&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;Standard&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;uniqueIdentifier&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;39fc5a87-2b95-48ff-a827-468902b78149&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;userName&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;dtladmin&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;virtualMachineCreationSource&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;FromGalleryImage&quot;</span>
</span><span class='line'>            <span class="p-Indicator">},</span>
</span><span class='line'>            <span class="s">&quot;type&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;Microsoft.DevTestLab/labs/virtualMachines&quot;</span>
</span><span class='line'>        <span class="p-Indicator">},</span>
</span><span class='line'>        <span class="p-Indicator">{</span>
</span><span class='line'>            <span class="s">&quot;id&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/zimsdtl/providers/Microsoft.KeyVault/vaults/labxxxx9607&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>            <span class="s">&quot;location&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;eastus&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>            <span class="s">&quot;name&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;labxxxx9607&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>            <span class="s">&quot;properties&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span>
</span><span class='line'>                <span class="s">&quot;accessPolicies&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span>
</span><span class='line'>                    <span class="p-Indicator">{</span>
</span><span class='line'>                        <span class="s">&quot;objectId&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;9d706dfc-a44a-4341-9cac-e995cc8a1530&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                        <span class="s">&quot;permissions&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span>
</span><span class='line'>                            <span class="s">&quot;secrets&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span>
</span><span class='line'>                                <span class="s">&quot;all&quot;</span>
</span><span class='line'>                            <span class="p-Indicator">]</span>
</span><span class='line'>                        <span class="p-Indicator">},</span>
</span><span class='line'>                        <span class="s">&quot;tenantId&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;72f988bf-86f1-41af-91ab-2d7cd011db47&quot;</span>
</span><span class='line'>                    <span class="p-Indicator">}</span>
</span><span class='line'>                <span class="p-Indicator">],</span>
</span><span class='line'>                <span class="s">&quot;enabledForDeployment&quot;</span><span class="p-Indicator">:</span> <span class="nv">true</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;provisioningState&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;Succeeded&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;sku&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span>
</span><span class='line'>                    <span class="s">&quot;family&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;A&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                    <span class="s">&quot;name&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;standard&quot;</span>
</span><span class='line'>                <span class="p-Indicator">},</span>
</span><span class='line'>                <span class="s">&quot;tenantId&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;72f988bf-86f1-41af-91ab-2d7cd011db47&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;vaultUri&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;https://labxxxx9607.vault.azure.net/&quot;</span>
</span><span class='line'>            <span class="p-Indicator">},</span>
</span><span class='line'>            <span class="s">&quot;tags&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span>
</span><span class='line'>                <span class="s">&quot;CreatedBy&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;DevTestLabs&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;hidden-DevTestLabs-LabUId&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;1f33aff8-4e19-43e2-b2fc-181ce85afd2a&quot;</span>
</span><span class='line'>            <span class="p-Indicator">},</span>
</span><span class='line'>            <span class="s">&quot;type&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;Microsoft.KeyVault/vaults&quot;</span>
</span><span class='line'>        <span class="p-Indicator">},</span>
</span><span class='line'>        <span class="p-Indicator">{</span>
</span><span class='line'>            <span class="s">&quot;etag&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;W/\&quot;806f86f0-0cdd-4424-9fbc-17b9ab331ad7\&quot;&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>            <span class="s">&quot;id&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/zimsdtl/providers/Microsoft.Network/virtualNetworks/vnxxxx&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>            <span class="s">&quot;location&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;eastus&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>            <span class="s">&quot;name&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;vnxxxx&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>            <span class="s">&quot;properties&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span>
</span><span class='line'>                <span class="s">&quot;addressSpace&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span>
</span><span class='line'>                    <span class="s">&quot;addressPrefixes&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span>
</span><span class='line'>                        <span class="s">&quot;10.0.0.0/20&quot;</span>
</span><span class='line'>                    <span class="p-Indicator">]</span>
</span><span class='line'>                <span class="p-Indicator">},</span>
</span><span class='line'>                <span class="s">&quot;dhcpOptions&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span>
</span><span class='line'>                    <span class="s">&quot;dnsServers&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">[]</span>
</span><span class='line'>                <span class="p-Indicator">},</span>
</span><span class='line'>                <span class="s">&quot;enableDdosProtection&quot;</span><span class="p-Indicator">:</span> <span class="nv">false</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;enableVmProtection&quot;</span><span class="p-Indicator">:</span> <span class="nv">false</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;provisioningState&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;Succeeded&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;resourceGuid&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;9f622d47-478c-44a1-9796-3ba51eb44259&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;subnets&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span>
</span><span class='line'>                    <span class="p-Indicator">{</span>
</span><span class='line'>                        <span class="s">&quot;etag&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;W/\&quot;806f86f0-0cdd-4424-9fbc-17b9ab331ad7\&quot;&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                        <span class="s">&quot;id&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/zimsdtl/providers/Microsoft.Network/virtualNetworks/vnxxxx/subnets/vnxxxxSubnet&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                        <span class="s">&quot;name&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;vnxxxxSubnet&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                        <span class="s">&quot;properties&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span>
</span><span class='line'>                            <span class="s">&quot;addressPrefix&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;10.0.0.0/20&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                            <span class="s">&quot;delegations&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">[],</span>
</span><span class='line'>                            <span class="s">&quot;provisioningState&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;Succeeded&quot;</span>
</span><span class='line'>                        <span class="p-Indicator">},</span>
</span><span class='line'>                        <span class="s">&quot;type&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;Microsoft.Network/virtualNetworks/subnets&quot;</span>
</span><span class='line'>                    <span class="p-Indicator">}</span>
</span><span class='line'>                <span class="p-Indicator">],</span>
</span><span class='line'>                <span class="s">&quot;virtualNetworkPeerings&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">[]</span>
</span><span class='line'>            <span class="p-Indicator">},</span>
</span><span class='line'>            <span class="s">&quot;tags&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span>
</span><span class='line'>                <span class="s">&quot;hidden-DevTestLabs-LabUId&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;1f33aff8-4e19-43e2-b2fc-181ce85afd2a&quot;</span>
</span><span class='line'>            <span class="p-Indicator">},</span>
</span><span class='line'>            <span class="s">&quot;type&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;Microsoft.Network/virtualNetworks&quot;</span>
</span><span class='line'>        <span class="p-Indicator">},</span>
</span><span class='line'>        <span class="p-Indicator">{</span>
</span><span class='line'>            <span class="s">&quot;id&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx/resourceGroups/zimsdtl/providers/Microsoft.Storage/storageAccounts/alabxxxx2409&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>            <span class="s">&quot;kind&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;StorageV2&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>            <span class="s">&quot;location&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;eastus&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>            <span class="s">&quot;name&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;alabxxxx2409&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>            <span class="s">&quot;properties&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span>
</span><span class='line'>                <span class="s">&quot;accessTier&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;Hot&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;creationTime&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;2019-03-01T08:43:18.0722775Z&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;encryption&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span>
</span><span class='line'>                    <span class="s">&quot;keySource&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;Microsoft.Storage&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                    <span class="s">&quot;services&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span>
</span><span class='line'>                        <span class="s">&quot;blob&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span>
</span><span class='line'>                            <span class="s">&quot;enabled&quot;</span><span class="p-Indicator">:</span> <span class="nv">true</span><span class="p-Indicator">,</span>
</span><span class='line'>                            <span class="s">&quot;lastEnabledTime&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;2019-03-01T08:43:18.1972664Z&quot;</span>
</span><span class='line'>                        <span class="p-Indicator">},</span>
</span><span class='line'>                        <span class="s">&quot;file&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span>
</span><span class='line'>                            <span class="s">&quot;enabled&quot;</span><span class="p-Indicator">:</span> <span class="nv">true</span><span class="p-Indicator">,</span>
</span><span class='line'>                            <span class="s">&quot;lastEnabledTime&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;2019-03-01T08:43:18.1972664Z&quot;</span>
</span><span class='line'>                        <span class="p-Indicator">}</span>
</span><span class='line'>                    <span class="p-Indicator">}</span>
</span><span class='line'>                <span class="p-Indicator">},</span>
</span><span class='line'>                <span class="s">&quot;networkAcls&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span>
</span><span class='line'>                    <span class="s">&quot;bypass&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;AzureServices&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                    <span class="s">&quot;defaultAction&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;Allow&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                    <span class="s">&quot;ipRules&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">[],</span>
</span><span class='line'>                    <span class="s">&quot;virtualNetworkRules&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">[]</span>
</span><span class='line'>                <span class="p-Indicator">},</span>
</span><span class='line'>                <span class="s">&quot;primaryEndpoints&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span>
</span><span class='line'>                    <span class="s">&quot;blob&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;https://alabxxxx2409.blob.core.windows.net/&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                    <span class="s">&quot;dfs&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;https://alabxxxx2409.dfs.core.windows.net/&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                    <span class="s">&quot;file&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;https://alabxxxx2409.file.core.windows.net/&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                    <span class="s">&quot;queue&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;https://alabxxxx2409.queue.core.windows.net/&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                    <span class="s">&quot;table&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;https://alabxxxx2409.table.core.windows.net/&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                    <span class="s">&quot;web&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;https://alabxxxx2409.z13.web.core.windows.net/&quot;</span>
</span><span class='line'>                <span class="p-Indicator">},</span>
</span><span class='line'>                <span class="s">&quot;primaryLocation&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;eastus&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;provisioningState&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;Succeeded&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;statusOfPrimary&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;available&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;supportsHttpsTrafficOnly&quot;</span><span class="p-Indicator">:</span> <span class="nv">true</span>
</span><span class='line'>            <span class="p-Indicator">},</span>
</span><span class='line'>            <span class="s">&quot;sku&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span>
</span><span class='line'>                <span class="s">&quot;name&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;Standard_LRS&quot;</span><span class="p-Indicator">,</span>
</span><span class='line'>                <span class="s">&quot;tier&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;Standard&quot;</span>
</span><span class='line'>            <span class="p-Indicator">},</span>
</span><span class='line'>            <span class="s">&quot;tags&quot;</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span>
</span><span class='line'>                <span class="s">&quot;hidden-DevTestLabs-LabUId&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;1f33aff8-4e19-43e2-b2fc-181ce85afd2a&quot;</span>
</span><span class='line'>            <span class="p-Indicator">},</span>
</span><span class='line'>            <span class="s">&quot;type&quot;</span><span class="p-Indicator">:</span> <span class="s">&quot;Microsoft.Storage/storageAccounts&quot;</span>
</span><span class='line'>        <span class="p-Indicator">}</span>
</span><span class='line'>    <span class="p-Indicator">]</span>
</span><span class='line'><span class="err">}</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">PLAY RECAP ******************************************************************************************************************************************************************************</span>
</span><span class='line'><span class="l-Scalar-Plain">localhost</span>                  <span class="p-Indicator">:</span> <span class="l-Scalar-Plain">ok=8    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0</span>
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2019/03/22/new-azure-virtual-machine-scale-set-features-support-in-ansible/">New Azure Virtual Machine Scale Set Features Support in Ansible</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2019-03-22T09:02:01+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>22</span><span class='date-suffix'>nd</span>, <span class='date-year'>2019</span></span> <span class='time'>9:02 am</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content">
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2019/03/22/new-ansible-modules-to-manage-azure-devtest-lab/">New Ansible Modules to Manage Azure DevTest Lab</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2019-03-22T09:01:02+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>22</span><span class='date-suffix'>nd</span>, <span class='date-year'>2019</span></span> <span class='time'>9:01 am</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>The new sample containing tasks to create and manage Azure DevTest Lab is available here:</p>

<p><a href="https://github.com/Azure-Samples/ansible-playbooks/blob/master/devtestlab-create.yml">https://github.com/Azure-Samples/ansible-playbooks/blob/master/devtestlab-create.yml</a></p>

<p>This sample will:</p>

<ul>
<li>create resource group</li>
<li>create DevTest Lab</li>
<li>create sample DevTest Lab policy</li>
<li>create sample DevTest Lab schedule</li>
<li>create sample DevTest Lab Virtual Network</li>
<li>create sample DevTest Lab artifact source</li>
<li>create instance of DTL Virtual Machine</li>
<li>list all artifact sources</li>
<li>get artifacts source facts</li>
<li>list ARM Template facts</li>
<li>get ARM Template facts</li>
<li>create instance of DevTest Lab Environment</li>
<li>create instance of DevTest Lab Image</li>
<li>delete instance of Lab</li>
</ul>


<h2>Running the sample</h2>

<h2>Variables</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'>  <span class="l-Scalar-Plain">vars</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">resource_group</span><span class="p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">resource_group_name</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span class='line'>    <span class="l-Scalar-Plain">lab_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">myLab</span>
</span><span class='line'>    <span class="l-Scalar-Plain">vn_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">myLabVirtualNetwork</span>
</span><span class='line'>    <span class="l-Scalar-Plain">vm_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">myLabVm</span>
</span><span class='line'>    <span class="l-Scalar-Plain">artifacts_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">myArtifacts</span>
</span><span class='line'>    <span class="l-Scalar-Plain">github_token</span><span class="p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;env&#39;,&#39;GITHUB_ACCESS_TOKEN&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span class='line'>    <span class="l-Scalar-Plain">location</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">eastus</span>
</span></code></pre></td></tr></table></div></figure>


<p>Following variables can be set in <strong>vars</strong> section of the playbook:</p>

<table>
<thead>
<tr>
<th>Variable Name</th>
<th>Description</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>resource_group</td>
<td>resource group where resources will be created</td>
<td>by default it&rsquo;s using <strong>resource_group_name</strong> parameter passed when running the playbook</td>
</tr>
<tr>
<td>location</td>
<td>location where resources should be created</td>
<td></td>
</tr>
<tr>
<td>lab_name</td>
<td>name of the lab instance</td>
<td></td>
</tr>
<tr>
<td>vn_name</td>
<td>lab virtual network name</td>
<td></td>
</tr>
<tr>
<td>vm_name</td>
<td>name of the vm instance</td>
<td></td>
</tr>
<tr>
<td>artifacts_name</td>
<td>lab artifacts name</td>
<td></td>
</tr>
<tr>
<td>github_token</td>
<td>GitHub token to access artifacts sources</td>
<td>by default playbook will attempt to get it from GITHUB_ACCESS_TOKEN environment variable</td>
</tr>
</tbody>
</table>


<h2>Create Resource Group</h2>

<p>This simple task creates a resource group if doesn&rsquo;t exist yet.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Create a resource group</span>
</span><span class='line'>  <span class="l-Scalar-Plain">azure_rm_resourcegroup</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">resource_group</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span class='line'>    <span class="l-Scalar-Plain">location</span><span class="p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">location</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Creating DevTest Lab</h2>

<p>This task creates an instance of DevTest Lab.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Create instance of Lab</span>
</span><span class='line'>  <span class="l-Scalar-Plain">azure_rm_devtestlab</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">resource_group</span><span class="p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">resource_group</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span class='line'>    <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lab_name</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span class='line'>    <span class="l-Scalar-Plain">location</span><span class="p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">location</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span class='line'>    <span class="l-Scalar-Plain">storage_type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">standard</span>
</span><span class='line'>    <span class="l-Scalar-Plain">premium_data_disks</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">no</span>
</span><span class='line'>  <span class="l-Scalar-Plain">register</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">output_lab</span>
</span></code></pre></td></tr></table></div></figure>


<h2>DevTest Lab Policies</h2>

<p>This task shows how to set up DevTest Lab policy settings.</p>

<p>Following values can be set:</p>

<table>
<thead>
<tr>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>user_owned_lab_vm_count</td>
<td>count of VMs that can be owned by an user</td>
</tr>
<tr>
<td>user_owned_lab_premium_vm_count</td>
<td>count of premium VMs that can be owned by an user</td>
</tr>
<tr>
<td>lab_vm_count</td>
<td>maximum lab VM count</td>
</tr>
<tr>
<td>lab_premium_vm_count</td>
<td>maximum lab premium VM count</td>
</tr>
<tr>
<td>lab_vm_size</td>
<td>allowed lab VMs size(s)</td>
</tr>
<tr>
<td>gallery_image</td>
<td>allowed gallery image(s)</td>
</tr>
<tr>
<td>user_owned_lab_vm_count_in_subnet</td>
<td>maximum number of user&rsquo;s VMs in a subnet</td>
</tr>
<tr>
<td>lab_target_cost</td>
<td>target cost of the lab</td>
</tr>
</tbody>
</table>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Create instance of DevTest Lab Policy</span>
</span><span class='line'>  <span class="l-Scalar-Plain">azure_rm_devtestlabpolicy</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">resource_group</span><span class="p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">resource_group</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span class='line'>    <span class="l-Scalar-Plain">lab_name</span><span class="p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lab_name</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span class='line'>    <span class="l-Scalar-Plain">policy_set_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">myDtlPolicySet</span>
</span><span class='line'>    <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">myDtlPolicy</span>
</span><span class='line'>    <span class="l-Scalar-Plain">fact_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">user_owned_lab_vm_count</span>
</span><span class='line'>    <span class="l-Scalar-Plain">threshold</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">5</span>
</span></code></pre></td></tr></table></div></figure>


<h2>DevTest Lab Schedules</h2>

<p>Sample task setting DevTest Lab VM schedule.</p>

<p>Currently allowed are:
|Name|Description|
|&mdash;-|&mdash;&mdash;&mdash;&ndash;|
|lab_vms_startup|Lab VMs startup time|
|lab_vms_shutdown|Lab VMs shutdown time|</p>

<p>Time and time zone id must be specified.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'>    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Create instance of DevTest Lab Schedule</span>
</span><span class='line'>      <span class="l-Scalar-Plain">azure_rm_devtestlabschedule</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">resource_group</span><span class="p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">resource_group</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span class='line'>        <span class="l-Scalar-Plain">lab_name</span><span class="p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lab_name</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span class='line'>        <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">lab_vms_shutdown</span>
</span><span class='line'>        <span class="l-Scalar-Plain">time</span><span class="p-Indicator">:</span> <span class="s">&quot;1030&quot;</span>
</span><span class='line'>        <span class="l-Scalar-Plain">time_zone_id</span><span class="p-Indicator">:</span> <span class="s">&quot;UTC+12&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">register</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">output</span>
</span></code></pre></td></tr></table></div></figure>


<h2>DevTest Lab Virtual Network</h2>

<p>This task creates default DevTest Lab virtual network.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'>    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Create instance of DevTest Labs virtual network</span>
</span><span class='line'>      <span class="l-Scalar-Plain">azure_rm_devtestlabvirtualnetwork</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">resource_group</span><span class="p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">resource_group</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span class='line'>        <span class="l-Scalar-Plain">lab_name</span><span class="p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lab_name</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span class='line'>        <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">vn_name</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span class='line'>        <span class="l-Scalar-Plain">location</span><span class="p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">location</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span class='line'>        <span class="l-Scalar-Plain">description</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">My DevTest Lab Virtual Network</span>
</span><span class='line'>      <span class="l-Scalar-Plain">register</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">output</span>
</span></code></pre></td></tr></table></div></figure>


<h2>DevTest Lab Artifact Source</h2>

<p>This task shows how to create DevTest Lab artifacts source.
DevTest Lab artifacts source is properly structured GitHub repository that contains artifact definition and ARM templates.
Please note that every lab comes with predefined public artifacts source.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'>    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Create instance of DevTest Labs artifacts source</span>
</span><span class='line'>      <span class="l-Scalar-Plain">azure_rm_devtestlabartifactsource</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">resource_group</span><span class="p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">resource_group</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span class='line'>        <span class="l-Scalar-Plain">lab_name</span><span class="p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lab_name</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span class='line'>        <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">artifacts_name</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span class='line'>        <span class="l-Scalar-Plain">uri</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">https://github.com/Azure/azure_preview_modules.git</span>
</span><span class='line'>        <span class="l-Scalar-Plain">source_type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">github</span>
</span><span class='line'>        <span class="l-Scalar-Plain">folder_path</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/tasks</span>
</span><span class='line'>        <span class="l-Scalar-Plain">security_token</span><span class="p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">github_token</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>DevTest Lab Virtual Machine</h2>

<p>This task shows how to create DevTest Labs virtual machine.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Create instance of DTL Virtual Machine</span>
</span><span class='line'>  <span class="l-Scalar-Plain">azure_rm_devtestlabvirtualmachine</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">resource_group</span><span class="p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">resource_group</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span class='line'>    <span class="l-Scalar-Plain">lab_name</span><span class="p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lab_name</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span class='line'>    <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">vm_name</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span class='line'>    <span class="l-Scalar-Plain">notes</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Virtual machine notes, just something....</span>
</span><span class='line'>    <span class="l-Scalar-Plain">os_type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">linux</span>
</span><span class='line'>    <span class="l-Scalar-Plain">vm_size</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Standard_A2_v2</span>
</span><span class='line'>    <span class="l-Scalar-Plain">user_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">dtladmin</span>
</span><span class='line'>    <span class="l-Scalar-Plain">password</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">ZSasfovobocu$$21!</span>
</span><span class='line'>    <span class="l-Scalar-Plain">lab_subnet</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="l-Scalar-Plain">virtual_network_name</span><span class="p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">vn_name</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">vn_name</span><span class="nv"> </span><span class="s">}}Subnet&quot;</span>
</span><span class='line'>    <span class="l-Scalar-Plain">disallow_public_ip_address</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">no</span>
</span><span class='line'>    <span class="l-Scalar-Plain">image</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="l-Scalar-Plain">offer</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">UbuntuServer</span>
</span><span class='line'>      <span class="l-Scalar-Plain">publisher</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Canonical</span>
</span><span class='line'>      <span class="l-Scalar-Plain">sku</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">16.04-LTS</span>
</span><span class='line'>      <span class="l-Scalar-Plain">os_type</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Linux</span>
</span><span class='line'>      <span class="l-Scalar-Plain">version</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">latest</span>
</span><span class='line'>    <span class="l-Scalar-Plain">artifacts</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">source_name</span><span class="p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">artifacts_name</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span class='line'>        <span class="l-Scalar-Plain">source_path</span><span class="p-Indicator">:</span> <span class="s">&quot;/Artifacts/linux-install-mongodb&quot;</span>
</span><span class='line'>    <span class="l-Scalar-Plain">allow_claim</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">no</span>
</span><span class='line'>    <span class="l-Scalar-Plain">expiration_date</span><span class="p-Indicator">:</span> <span class="s">&quot;2029-02-22T01:49:12.117974Z&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Listing All Artifact Sources and Artifacts</h2>

<p>This task lists all artifacts sources in the lab.
Please use it to see default and custom artifacts sources.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'>    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">List all artifact sources</span>
</span><span class='line'>      <span class="l-Scalar-Plain">azure_rm_devtestlabartifactsource_facts</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">resource_group</span><span class="p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">resource_group</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span class='line'>        <span class="l-Scalar-Plain">lab_name</span><span class="p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lab_name</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">register</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">output</span>
</span><span class='line'>    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">debug</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">var</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">output</span>
</span></code></pre></td></tr></table></div></figure>


<p>Following task lists all the artifact in <strong>public repo</strong> which is predefined artifact source.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'>    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Get artifacts source facts</span>
</span><span class='line'>      <span class="l-Scalar-Plain">azure_rm_devtestlabartifact_facts</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">resource_group</span><span class="p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">resource_group</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span class='line'>        <span class="l-Scalar-Plain">lab_name</span><span class="p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lab_name</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span class='line'>        <span class="l-Scalar-Plain">artifact_source_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">public repo</span>
</span><span class='line'>      <span class="l-Scalar-Plain">register</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">output</span>
</span><span class='line'>    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">debug</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">var</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">output</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Getting Information on ARM Templates in Artifact Source</h2>

<p>This task lists all the ARM templates in <strong>public environment repo</strong> that is predefined repo with templates.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'>    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">List ARM Template facts</span>
</span><span class='line'>      <span class="l-Scalar-Plain">azure_rm_devtestlabarmtemplate_facts</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">resource_group</span><span class="p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">resource_group</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span class='line'>        <span class="l-Scalar-Plain">lab_name</span><span class="p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lab_name</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span class='line'>        <span class="l-Scalar-Plain">artifact_source_name</span><span class="p-Indicator">:</span> <span class="s">&quot;public</span><span class="nv"> </span><span class="s">environment</span><span class="nv"> </span><span class="s">repo&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">register</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">output</span>
</span><span class='line'>    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">debug</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">var</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">output</span>
</span></code></pre></td></tr></table></div></figure>


<p>And following task retrieves details of a specific ARM template from the repository:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'>    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Get ARM Template facts</span>
</span><span class='line'>      <span class="l-Scalar-Plain">azure_rm_devtestlabarmtemplate_facts</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">resource_group</span><span class="p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">resource_group</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span class='line'>        <span class="l-Scalar-Plain">lab_name</span><span class="p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lab_name</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span class='line'>        <span class="l-Scalar-Plain">artifact_source_name</span><span class="p-Indicator">:</span> <span class="s">&quot;public</span><span class="nv"> </span><span class="s">environment</span><span class="nv"> </span><span class="s">repo&quot;</span>
</span><span class='line'>        <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">ServiceFabric-LabCluster</span>
</span><span class='line'>      <span class="l-Scalar-Plain">register</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">output</span>
</span><span class='line'>    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">debug</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">var</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">output</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Creating DevTest Lab Environment</h2>

<p>Finally following task creates DevTest Lab environment. As you see it refers one of the templates from <strong>public environment repo</strong>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'>    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Create instance of DevTest Lab Environment</span>
</span><span class='line'>      <span class="l-Scalar-Plain">azure_rm_devtestlabenvironment</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">resource_group</span><span class="p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">resource_group</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span class='line'>        <span class="l-Scalar-Plain">lab_name</span><span class="p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lab_name</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span class='line'>        <span class="l-Scalar-Plain">user_name</span><span class="p-Indicator">:</span> <span class="s">&quot;@me&quot;</span>
</span><span class='line'>        <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">myEnvironment</span>
</span><span class='line'>        <span class="l-Scalar-Plain">location</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">eastus</span>
</span><span class='line'>        <span class="l-Scalar-Plain">deployment_template</span><span class="p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">output_lab.id</span><span class="nv"> </span><span class="s">}}/artifactSources/public</span><span class="nv"> </span><span class="s">environment</span><span class="nv"> </span><span class="s">repo/armTemplates/WebApp&quot;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">register</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">output</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Creating DevTest Lab Image</h2>

<p>This is also a very useful task. It creates DevTest Lab image from existing DevTest Lab Virtual Machine.
It can be later used to created new DevTest Lab virtual machines.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'>    <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Create instance of DevTest Lab Image</span>
</span><span class='line'>      <span class="l-Scalar-Plain">azure_rm_devtestlabcustomimage</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">resource_group</span><span class="p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">resource_group</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span class='line'>        <span class="l-Scalar-Plain">lab_name</span><span class="p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lab_name</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span class='line'>        <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">myImage</span>
</span><span class='line'>        <span class="l-Scalar-Plain">source_vm</span><span class="p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">output_vm.virtualmachines[0][&#39;name&#39;]</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span class='line'>        <span class="l-Scalar-Plain">linux_os_state</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">non_deprovisioned</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Deleting the Lab</h2>

<p>Final task deletes entire lab.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Delete instance of Lab</span>
</span><span class='line'>  <span class="l-Scalar-Plain">azure_rm_devtestlab</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">resource_group</span><span class="p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">resource_group</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span class='line'>    <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lab_name</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span class='line'>    <span class="l-Scalar-Plain">state</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">absent</span>
</span><span class='line'>  <span class="l-Scalar-Plain">register</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">output</span>
</span><span class='line'><span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Assert the change was correctly reported</span>
</span><span class='line'>  <span class="l-Scalar-Plain">assert</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">that</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">output.changed</span>
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/2">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    
  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2019 - Your Name -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a> | Themed with <a href="https://github.com/lucaslew/whitespace">Whitespace</a></span>
</p>

</footer>
  










  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
